$def with (tree, ud, invalid)
$ SPREADSHEETS = ud.spreadsheet_name.split(',')
$ CALENDARS = ud.calendar_name.split(',')
$ SSID = ud.spreadsheet_id.split(',')
$ CLID = ud.calendar_id.split(',')
<html>
<head>
<link rel="stylesheet" type="text/css" href="/static/webflipflapp.css" /> 
<script src="/static/jquery-2.0.3.min.js"></script>
<script>
</script>
</head>
<body>
<div class="wholedoc">    
    
<!-- THE INVALID ERROR -->
$if invalid:
    <div class="invaliddiv">
    <p class="invalidheader">INVALID SPREADSHEETS. no Webflipflap Flystock spreadsheets.</p>
    <table class="invalidtable">
    <tr class='invalidtableheader'>
        <th>Name</th>
        <th>ID</th>
    </tr>
    $for issid in invalid:
        $ iname = tree.get_first_where(lambda k: k['id'] == issid)['title']
        $if loop.even:
            <tr class='invalidtableeven'>
        $else:
            <tr class='invalidtableodd'>
        <td>$(iname)</td>
        <td>$(issid)</td>
        </tr>
    </table>
    </div> 

    
<!-- The website title -->
<div class="docheader">
<h1><a href="/">WebFlipFlapp</a></h1>
<h2>from __past__ import why_do_i_forget_that_every_single_time<br/>
from __future__ import webflipflapp!</h2>
</div>

<!-- The navigation menu -->
<div class="menu">
    <span class="menuheader">menu:</span>
    <span class="menuitem"><a href="/drive">choose spreadsheet</a></span>
    <span class="menuitem"><a href="/calendar">choose calendar</a></span>
    <span class="menuitem"><a href="/boxes">view boxes</a></span>
</div> 

<!-- The spreadsheet and calendar selection -->
<div class="menu2">
<dl>
<dt class="menuheader2">spreadsheets:</dt>
$for ss in SPREADSHEETS:
    <dd>- $(ss)</dd>
<dt class="menuheader2">calendars:</dt>
$for cal in CALENDARS:
    <dd>- $(cal)</dd>
</dl>
</div> 

<!-- The main body -->
<div class="docbody">

<p class='mainheading' style='color:#7A1C1C'>Warning: lazy programmer</p>
<div class='info'>If you want to create a new spreadsheet, please do that via the <a href="https://drive.google.com">Google Drive</a> web interface. Choose one of the offered template(s) (<a href='/static/flytemplate.ods'>flytemplate</a>), upload it to your Google Drive and name it after your grandma's uncle's second dog. Refresh this page after and do not bug the developer. Currently there's only one template.</div>
<p class='mainheading'>Your Google Drive</p>
<div class='info'>Choose a compatible spreadsheet file that is used as the storage backend for your things.</div>
<form name='input' action="/drive" method='get'>
<table class='drivetable'>
    <tr class='drivetableheader'>
        <th>Filename</th>
        <th>Choice</th>
    </tr>
$for level, value in tree.walkthrough(key=lambda x: ('folder' not in x['mimeType'], x['title'])):
    $ checked = 'checked' if value['id'] in SSID else ''
    $ isSS = value['mimeType'] == 'application/vnd.google-apps.spreadsheet'
    $ name = value['title']
    $ icon = value['iconLink']
    $ ind = 20*level+6
    $if loop.even:
        <tr class='drivetableeven'>
    $else:
        <tr class='drivetableodd'>
    <td style='text-align:left'>        
    <div style='text-indent:$(ind)px'><img src="$(icon)"/>$name</div>
    </td>
    <td style='text-align:center'>
    $if isSS:
        <input type="checkbox" name="selected" value="$(value['id'])" $(checked) /></td>
    </tr>
</table>
<div class='info' style='text-align:right'><input type='submit' value='Choose'></div>
</form>

</div>

<div id='footspacer'></div>
<img src="https://developers.google.com/appengine/images/appengine-noborder-120x30.gif" alt="Powered by Google App Engine" />
</div>
</body>
</html>
