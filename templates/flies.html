$def with (ud, info)

$# set all statically loaded files for this template
$var title: webFlipFlapp
$var login_link: $info['login_url']
$var auth_link: $info['auth_url']
$var logout_link: $info['logout_url']
$var user_email: $info['email']
$var nickname: $info['nickname']
$var has_cred: $info['has_cred']
$var page: flies

$ SPREADSHEETS = ud.spreadsheet_name.split(',')
$ CALENDARS = ud.calendar_name.split(',')
$ SSID = ud.spreadsheet_id.split(',')
$ CLID = ud.calendar_id.split(',')

$ test1 = """$(function () {
$               $('table').footable().bind('footable_filtering', function (e) {
$                       var selected = $('.filter-status').find(':selected').text();
$                       if (selected && selected.length > 0) {
$                           e.filter += (e.filter && e.filter.length > 0) ? ' ' + selected : selected;
$                           e.clear = !e.filter;
$                       };
$                   });
$               $('.clear-filter').click(function (e) {
$                       e.preventDefault();
$                       $('.filter-status').val('');
$                       $('table.demo').trigger('footable_clear_filter');
$                   });
$               $('.filter-status').change(function (e) {
$                       e.preventDefault();
$                       $('table').trigger('footable_filter', {filter: $('#filter').val()});
$                   });
$               $('.generate-labels').click(function (e) {
$                       e.preventDefault();
$                   });
$           });
$           function getfilteredData() {
$               var flies = [];
$               var data = $("tbody tr").filter(function() { return $(this).css("display") == "table-row" });
$               for (var i=0; i<data.length;i++) {
$                   var row = data.eq(i).find('td');
$                   var fly = {};
$                   fly['Label'] = row.eq(0).text();
$                   fly['Short Identifier'] = row.eq(1).text();
$                   fly['Genotype'] = row.eq(2).text();
$                   flies.push(fly);
$               }
$               $('#myinput').val(JSON.stringify(flies));
$               return true;
$           }
$           """
$ test2 = "\n".join(["loadFlies('%s', '%s');" % ss for ss in zip(SSID,SPREADSHEETS)])
$ test = test1 + "\n" + test2
$var jsfiles: /static/js/wff.js
$var jscode: $:test


<div class="container">

  <h3>Flies in your Stocklists</h3>

  <p>Loading: 
    $for ssid, ssname in zip(SSID, SPREADSHEETS):
        <span id="wff-box-loader-$ssid" class="label label-warning">$ssname <i class="icon-spinner icon-spin"></i></span>
  </p>


  <form name="myform" id="myform" action='/labels' onsubmit="return getfilteredData()" method="post" target="_blank" class="form-inline">
    <input type="hidden" id="myinput" name="tabledata" value="HAHA" />
    <fieldset>
      <legend>Search</legend>
      <label>Match:</label>
      <input id="filter" type="text" placeholder="foo bar baz ..."/>
      <label>Stocklist:</label>
      <select class="filter-status">
                 <option></option>
                 $for (slid, sln) in zip(SSID,SPREADSHEETS):
                     <option value="$slid">$sln</option>
      </select>
      <button type="submit" class="btn">Download labels</button>
    </fieldset>
  </form>

  <table class="footable table" data-filter="#filter" data-filter-text-only="true">
    <thead>
      <tr>
        <th data-toggle="true">Label</th>
        <th>Short Identifier</th>
        <th data-hide="phone">Genotype</th>
        <th data-hide="all">X</th>
        <th data-hide="all">Y</th>
        <th data-hide="all">C2a</th>
        <th data-hide="all">C2b</th>
        <th data-hide="all">C3a</th>
        <th data-hide="all">C3b</th>
        <th data-hide="all">Extra info</th>
        <th data-hide="all">Mod</th>
        <th data-hide="phone">Box</th>
        <th data-hide="phone">Stocklist</th>
      </tr>
    </thead>
    <tbody id="wff-boxes-flies">
    </tbody>
  </table>

</div>

</body>
</html>
